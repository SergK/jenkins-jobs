- job-template:
    name: '{version-id}.all'
    builders:
      - shell:
          !include-raw-escape builders/all.sh
    description: |
      Build artifacts, iso, img and upgrade tarball
    node: iso
    properties:
      - heavy-job:
          weight: 1
      - throttle:
          categories:
            - iso_builds
          max-per-node: 1
          option: category
    parameters:
      - string:
          name: BASE_VERSION
          default: '{base-version}'
      - string:
          name: deep_clean
          default: 'true'
          description: Perform deep_clean or not. Default is "true". Set any other value
            to disable it.
    publishers:
      - archive:
          allow-empty: false
          artifacts: artifacts/*.data.txt, artifacts/*.data.html, version.yaml.txt,
            *magnet_link.txt, listing.txt, artifacts/*changelog, data_build_url.txt
          latest-only: false
      - description-setter:
          regexp: (<a href=.*a> <a href=.*a><br>magnet.*<br>)
          set-for-matrix: false
      - email-default:
          mail-to: 'devops+alert@mirantis.com, fuel-osci@mirantis.com'
      - trigger-parameterized-builds:
        - project: deploy_iso_on_cachers,{version-id}.smoke,{version-id}.centos.bvt_1,{version-id}.ubuntu.bvt_2
          condition: UNSTABLE_OR_BETTER
          property-file: magnet_link.txt
          triggerWithNoParameters: false
        - project: deploy_iso_on_cachers
          condition: UNSTABLE_OR_BETTER
          property-file: upgrade_magnet_link.txt
          triggerWithNoParameters: false
    scm:
      - stackforge:
          branch: '{branch}'
          repo: fuel-main
    triggers:
      - timed: '{timer}'