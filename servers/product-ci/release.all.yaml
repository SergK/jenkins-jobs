- job-template:
    name: '{name}.all'
    disabled: true
    builders:
      - shell:
          !include-raw-escape builders/all.sh
    description: |
      Build artifacts, iso, img and upgrade tarball
    node: upgrade
    properties:
      - heavy-job:
          weight: 1
      - throttle:
          categories:
            string: iso_builds
          enabled: true
          max-per-node: 1
          maxConcurrentTotal: 0
          option: category
    parameters:
      - string:
          name: deep_clean
          default: 'true'
          description: Perform deep_clean or not. Default is "true". Set any other value
            to disable it.
    publishers:
      - archive:
          allowEmptyArchive: false
          artifacts: artifacts/*.data.txt, artifacts/*.data.html, version.yaml.txt,
            magnet_link.txt, data_magnet_link.txt, listing.txt
          latestOnly: false
      - description-setter:
          regexp: (<a href=.*a> <a href=.*a><br>magnet.*<br>)
          set-for-matrix: false
      - email:
          notify-every-unstable-build: true
          recipients: devops+alert@mirantis.com fuel-osci@mirantis.com
          send-to-individuals: false
      - trigger-parameterized-builds:
        - project: deploy_iso_on_cachers,{name}.smoke,{name}.centos.bvt_1,{name}.ubuntu.bvt_2
          condition: UNSTABLE_OR_BETTER
          property-file: magnet_link.txt
          triggerWithNoParameters: false
        - project: deploy_iso_on_cachers
          condition: UNSTABLE_OR_BETTER
          property-file: upgrade_magnet_link.txt
          triggerWithNoParameters: false
    scm:
      - git:
          branches:
            - origin/master
          remotes:
            - github:
                url: https://github.com/stackforge/fuel-main.git
          wipe-workspace: false
    wrappers:
      - ansicolor:
          colormap: xterm