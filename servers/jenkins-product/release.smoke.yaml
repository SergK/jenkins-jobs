- job-template:
    name: '{name}.smoke'
    disabled: true
    builders:
      - shell:
          !include-raw-escape builders/smoke.sh
    concurrent: true
    description: |
      <pre>
      Scenario: deploy_simple_cinder
       1. Create cluster
       2. Add 1 node with controller role
       3. Add 1 node with compute role
       4. Add 1 node with cinder role
       5. Deploy the cluster
       6. Validate cluster was set up correctly, there are no dead
       services, there are no errors in logs
       7. Run OSTF
      </pre>
    logrotate:
      artifactDaysToKeep: -1
      artifactNumToKeep: -1
      daysToKeep: 30
      numToKeep: 50
    node: smoke
    properties:
      - heavy-job:
          weight: 4
      - throttle:
          configVersion: 1
          enabled: true
          max-per-node: 1
          maxConcurrentTotal: 0
          option: project
    parameters:
      - string:
          name: MAGNET_LINK
    publishers:
      - archive:
          allowEmptyArchive: false
          artifacts: '**/nosetests.xml,logs/*'
          latestOnly: false
      - junit:
          keep-long-stdio: false
          results: '**/nosetests.xml'
      - email-ext:
          attach-build-log: false
          body: |
            Something is wrong with the ISO: it does not pass smoke test for deployment.
            We need to fix this ASAP.


            Please get into the IRC (#fuel-qa) to check if someone is fixing this already,
            or start fixing it yourself.


            When you start working on the issue

            - inform others via this mailing list,

            - set build description for the failied build in Jenkins: add link to corresponding
            Launchpad bug or any related info.


            $BUILD_URL


            $BUILD_LOG


            $BUILD_URL
          compressBuildLog: false
          configuredTriggers:
            aborted:
              attach-build-log: false
              body: $PROJECT_DEFAULT_CONTENT
              compressBuildLog: false
              culprits: false
              developers: false
              recipients: true
              requester: true
              subject: $PROJECT_DEFAULT_SUBJECT
            failure:
              attach-build-log: false
              body: $PROJECT_DEFAULT_CONTENT
              compressBuildLog: false
              culprits: false
              developers: false
              recipients: true
              requester: true
              subject: $PROJECT_DEFAULT_SUBJECT
            fixed:
              attach-build-log: false
              body: |
                Test passed. Thanks, everyone.


                $BUILD_URL
              compressBuildLog: false
              culprits: false
              developers: false
              recipients: true
              requester: true
              subject: $PROJECT_DEFAULT_SUBJECT
            still-failing:
              attach-build-log: false
              body: $PROJECT_DEFAULT_CONTENT
              compressBuildLog: false
              culprits: false
              developers: false
              recipients: true
              requester: true
              subject: $PROJECT_DEFAULT_SUBJECT
          ctype: default
          recipients: devops+alert@mirantis.com,fuel-core-team@mirantis.com
          reply-to: $DEFAULT_REPLYTO
          saveOutput: false
          subject: '[Jenkins] Attention - $DEFAULT_SUBJECT'
    scm:
      - git:
          branches:
            - origin/master
          clean: true
          remotes:
            - github:
                url: https://github.com/stackforge/fuel-main.git
          wipe-workspace: false
    wrappers:
      - timeout:
          fail: true
          timeout: 200